<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jerry Wong - Physiotherapist & Event Host</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .nav-link {
            transition: color 0.2s, border-bottom 0.2s;
        }
        .nav-link:hover {
            color: #008080; /* Teal/Professional hover color */
            border-bottom: 2px solid #008080;
        }
        .carousel-container {
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .carousel-item {
            flex-shrink: 0;
            width: 85%; /* Adjust width for mobile view */
            scroll-snap-align: start;
        }
        @media (min-width: 768px) {
            .carousel-item {
                width: 30%; /* Adjust width for desktop view */
            }
        }
        .partner-logo {
            filter: grayscale(100%);
            opacity: 0.7;
            transition: opacity 0.3s, filter 0.3s;
            max-height: 50px;
            object-fit: contain;
        }
        .partner-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
        }
        /* Custom styles for the Gemini Insight Box */
        .insight-box {
            background-color: #f0fff4; /* Light mint background */
            border: 2px solid #38a169; /* Green border */
        }
        /* Image placeholder styles */
        .image-placeholder {
            background: linear-gradient(135deg, #38a169 0%, #2c7a5a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .profile-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Fixed Navigation Bar -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 bg-white shadow-lg z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="#home" class="text-xl font-extrabold text-teal-700 rounded-lg p-2 transition duration-150 hover:bg-teal-50">JERRY WONG</a>
                <div class="flex space-x-4 md:space-x-8">
                    <a href="#home" class="nav-link text-gray-700 py-1 font-medium">Home</a>
                    <a href="#about" class="nav-link text-gray-700 py-1 font-medium">About Me</a>
                    <a href="#gallery" class="nav-link text-gray-700 py-1 font-medium">Gallery</a>
                    <a href="#contact" class="nav-link text-gray-700 py-1 font-medium">Contact</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="pt-16">

        <!-- 1. Home Section -->
        <section id="home" class="min-h-screen flex flex-col justify-center items-center py-20 px-4 bg-white">
            <div class="max-w-4xl text-center">
                <!-- Big Profile Photo -->
                <div class="w-48 h-48 sm:w-64 sm:h-64 rounded-full mx-auto ring-4 ring-teal-500/50 mb-8 transition transform hover:scale-105 overflow-hidden image-placeholder">
                    <div class="profile-placeholder">
                        <img src="Big Profile Photo.JPG" alt="Jerry Wong Professional Profile Photo" 
                         class="w-full h-full object-cover" onerror="this.style.display='none'">
                    
                    </div>
                </div>
                
                <h1 class="text-4xl sm:text-6xl font-extrabold text-gray-900 leading-tight mb-4">
                    JERRY WONG <span class="text-teal-600">LOK TO</span>
                </h1>
                <p class="text-xl sm:text-2xl font-light text-gray-600 mb-12">
                    Physiotherapist & <span class="font-semibold">Professional Event Host</span>
                </p>
            </div>

            <!-- Photo Scroll Section (Carousel) -->
            <div class="w-full max-w-7xl overflow-x-auto carousel-container flex space-x-4 p-4 md:p-8 bg-gray-100 rounded-xl shadow-inner">
                <!-- Carousel items with placeholders -->
                <div class="carousel-item">
                    <div class="w-full h-80 rounded-lg overflow-hidden image-placeholder">
                        <div class="profile-placeholder">
                            <img src="Event hosting mid-autumn Festival.jpg" alt="Event Hosting" class="w-full h-full object-cover" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="w-full h-80 rounded-lg overflow-hidden image-placeholder">
                        <div class="profile-placeholder">
                            <img src="Academic Reception HKCGI Event.JPG" alt="Academic Reception" class="w-full h-full object-cover" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="w-full h-80 rounded-lg overflow-hidden image-placeholder">
                        <div class="profile-placeholder">
                           <img src="Awards Ceremony Corporate Governance.JPG" alt="Awards Ceremony" class="w-full h-full object-cover" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="w-full h-80 rounded-lg overflow-hidden image-placeholder">
                        <div class="profile-placeholder">
                             <img src="Schools Challenge JA Hong Kong & J.P. Morgan.jpg" alt="Schools Challenge" class="w-full h-full object-cover" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="w-full h-80 rounded-lg overflow-hidden image-placeholder">
                        <div class="profile-placeholder">
                            <img src="UNICEF Speaker Edvocate Program.jpg" alt="UNICEF Speaker" class="w-full h-full object-cover" onerror="this.style.display='none'">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Corporate Partners Section -->
            <div class="mt-20 w-full max-w-6xl px-4">
                <h3 class="text-2xl font-bold text-gray-700 text-center mb-10">Esteemed Partners</h3>
                <div class="flex flex-wrap justify-center items-center gap-6 sm:gap-10">
                    <!-- Partner Logos/Names -->
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">Hong Kong Polytechnic University</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">Junior Achievement Hong Kong</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">JP Morgan</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">HK Chartered Governance Institute</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">Á¶ÆÂçîAEEA</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">Hong Kong Committee for UNICEF</div>
                    <div class="partner-logo text-gray-500 font-semibold text-sm sm:text-base p-2 text-center transition duration-300 hover:text-teal-600">Êü¥ÁÅ£ÂçÄË°óÂùäÁ¶èÂà©ÊúÉ</div>
                </div>
            </div>

        </section>

        <!-- 2. About Me Section -->
        <section id="about" class="py-20 px-4 sm:px-6 lg:px-8 bg-gray-100">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-4xl font-extrabold text-teal-700 mb-10 border-b-4 border-teal-300 pb-2">About Jerry</h2>
                
                <div class="space-y-8 text-lg text-gray-700">
                    <!-- About Me Description -->
                    <p class="text-xl font-medium text-teal-700">
                        Becoming a person with a full breadth of stories and using my voice and knowledge to influence others is what drives me. I am no longer afraid of taking on challenges. My goal is always to keep growing into a holistic and enriching self. Most importantly, I hope that, in the end, I can positively influence someone who has encountered a miserable situation like I once did.
                    </p>

                    <p>
                        Therefore, while my medical background as a Physiotherapist gives me the stamina, resilience, and attention to detail, my passion for public speaking and event hosting provides the energy and confidence to pursue more of what I want. What started off as a <span class="font-semibold">self-challenge</span> has become an integral part of my life. Because of this journey, I am not afraid of taking challenges, and I am committed to a path of continuous self-challenging forever.
                    </p>
                </div>
                
                <!-- GEMINI LLM FEATURE: Life Insight Generator -->
                <div class="mt-16 p-6 md:p-8 rounded-xl shadow-2xl insight-box">
                    <h3 class="text-2xl font-bold text-teal-700 mb-4 flex items-center">
                        <span class="mr-2">üí°</span>A Life Insight You Think Has Been Helpful to Yourself
                    </h3>
                    <p class="text-sm text-gray-600 mb-4">Ask a question about your personal journey (e.g., career, confidence, overcoming challenges), and receive an actionable insight rooted in my experience that you can apply to yourself.</p>
                    
                    <textarea id="insight-query" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 text-gray-700" placeholder="e.g., What's a good mindset for embracing a big career change?"></textarea>
                    
                    <button id="generate-insight" 
                            class="mt-4 w-full sm:w-auto px-6 py-3 bg-teal-600 text-white font-semibold rounded-lg shadow-lg hover:bg-teal-700 transition duration-300 transform hover:scale-[1.01] disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="button-text">Get Life Insight üí°</span>
                    </button>
                    
                    <div id="insight-output" class="mt-6 p-4 bg-white rounded-lg border border-gray-200 hidden">
                        <h4 class="font-bold text-teal-700 mb-2">Jerry's Insight:</h4>
                        <p id="insight-text" class="text-gray-800"></p>
                        <p id="insight-sources" class="text-xs text-gray-500 mt-3"></p>
                    </div>

                     <!-- Loading State -->
                    <div id="loading-indicator" class="mt-6 hidden flex items-center justify-center space-x-2">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-teal-600"></div>
                        <span class="text-teal-600 font-medium">Reflecting and generating insight...</span>
                    </div>

                    <div id="error-message" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded hidden" role="alert">
                        <span class="font-bold">Error:</span> <span id="error-text"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Gallery Section -->
        <section id="gallery" class="py-20 px-4 sm:px-6 lg:px-8 bg-white">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-4xl font-extrabold text-teal-700 mb-10 border-b-4 border-teal-300 pb-2">Gallery: Moments on Stage</h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    
                    <!-- Gallery Item 1 -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition transform hover:shadow-xl hover:-translate-y-1">
                        <div class="w-full h-64 image-placeholder">
                            <div class="profile-placeholder">
                                <img src="Event hosting mid-autumn Festival.jpg" alt="Mid-Autumn Festival Event (Êü¥ÁÅ£ÂçÄË°óÂùäÁ¶èÂà©ÊúÉ)" class="w-full h-full object-cover" onerror="this.style.display='none'">
                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <p class="font-semibold text-lg text-gray-800">Mid-Autumn Festival Event (Êü¥ÁÅ£ÂçÄË°óÂùäÁ¶èÂà©ÊúÉ)</p>
                        </div>
                    </div>

                    <!-- Gallery Item 2 -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition transform hover:shadow-xl hover:-translate-y-1">
                        <div class="w-full h-64 image-placeholder">
                            <div class="profile-placeholder">
                                <img src="Schools Challenge JA Hong Kong & J.P. Morgan.jpg" alt="The Schools Challenge (JA Hong Kong & J.P. Morgan)" class="w-full h-full object-cover" onerror="this.style.display='none'">
                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <p class="font-semibold text-lg text-gray-800">The Schools Challenge (JA Hong Kong & J.P. Morgan)</p>
                        </div>
                    </div>
                    
                    <!-- Gallery Item 3 -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition transform hover:shadow-xl hover:-translate-y-1">
                        <div class="w-full h-64 image-placeholder">
                            <div class="profile-placeholder">
                                 <img src="UNICEF Speaker Edvocate Program.jpg" alt="UNICEF 'Edvocate' School Speaker Engagement" class="w-full h-full object-cover" onerror="this.style.display='none'">                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <p class="font-semibold text-lg text-gray-800">UNICEF 'Edvocate' School Speaker Engagement</p>
                        </div>
                    </div>

                    <!-- Gallery Item 4 -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition transform hover:shadow-xl hover:-translate-y-1">
                        <div class="w-full h-64 image-placeholder">
                            <div class="profile-placeholder">
                                <img src="Mother's Day Workshop Á¶ÆÂçîAEEA Health Event" alt="Á¶ÆÂçîAEEA Mother's Day Health Workshop" class="w-full h-full object-cover" onerror="this.style.display='none'">
                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <p class="font-semibold text-lg text-gray-800">Á¶ÆÂçîAEEA Mother's Day Health Workshop</p>
                        </div>
                    </div>

                    <!-- Gallery Item 5 -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden transition transform hover:shadow-xl hover:-translate-y-1">
                        <div class="w-full h-64 image-placeholder">
                            <div class="profile-placeholder">
                                <img src="Polyu Student Emcee. jpg.png" alt="Polyu Student Emcee" class="w-full h-full object-cover" onerror="this.style.display='none'">
                            </div>
                        </div>
                        <div class="p-4 text-center">
                            <p class="font-semibold text-lg text-gray-800">Polyu Student Emcee</p>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- 4. Contact Section -->
        <section id="contact" class="py-20 px-4 sm:px-6 lg:px-8 bg-gray-100">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold text-teal-700 mb-10 border-b-4 border-teal-300 pb-2 inline-block">Get In Touch</h2>
                <p class="text-xl text-gray-600 mb-12">I am ready to collaborate, whether it's for your next major event or for a physiotherapy consultation. Let's connect!</p>
                
                <div class="flex flex-col sm:flex-row justify-center space-y-6 sm:space-y-0 sm:space-x-8">
                    
                    <!-- Email -->
                    <div class="flex items-center justify-center p-4 bg-white rounded-xl shadow-md hover:shadow-lg transition duration-300">
                        <svg class="w-6 h-6 text-teal-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 10H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2z"></path></svg>
                        <a href="mailto:jerrywlthw@gmail.com" class="text-lg font-medium text-gray-700 hover:text-teal-700">jerrywlthw@gmail.com</a>
                    </div>

                    <!-- LinkedIn -->
                    <div class="flex items-center justify-center p-4 bg-white rounded-xl shadow-md hover:shadow-lg transition duration-300">
                        <svg class="w-6 h-6 text-teal-600 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM5 9h4v12H5zM7 5a2 2 0 110-4 2 2 0 010 4z"></path></svg>
                        <a href="https://www.linkedin.com/in/jerrywonglokto/" target="_blank" class="text-lg font-medium text-gray-700 hover:text-teal-700">LinkedIn Profile</a>
                    </div>

                    <!-- Instagram -->
                    <div class="flex items-center justify-center p-4 bg-white rounded-xl shadow-md hover:shadow-lg transition duration-300">
                        <svg class="w-6 h-6 text-teal-600 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4 4h-2a2 2 0 00-2 2v2a2 2 0 002 2h2v4h-4v-4h-2V8a4 4 0 014-4h2v2z"></path></svg>
                        <a href="https://www.instagram.com/jellior_milo/" target="_blank" class="text-lg font-medium text-gray-700 hover:text-teal-700">@jellior_milo</a>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6">
            <div class="max-w-7xl mx-auto text-center px-4">
                <p>&copy; 2025 Jerry Wong. All rights reserved.</p>
            </div>
        </footer>
    </main>

    <script>
        // --- Gemini API Configuration ---
        const apiKey = "AIzaSyDonmYhfe2DLrtRo_IhdrcKA7e1FhC8qDE"; // Canvas will provide this key at runtime
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Utility for exponential backoff retry logic
        async function fetchWithBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    // Wait and retry
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // --- Gemini API Call Functions ---

        async function getLifeInsight(query) {
            const systemPrompt = "You are Jerry Wong, a motivational speaker and experienced event host focused on self-improvement and resilience. Provide a single, concise, encouraging life insight or actionable mindset tip, framed as advice that has been personally helpful to you, Jerry, that you believe would be helpful to the user on their journey. Focus on personal growth and overcoming challenges. DO NOT provide medical advice. Keep the response under 100 words. Start your reply with 'The Insight That Could Help You:'";
            
            const payload = {
                contents: [{ parts: [{ text: query }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }
                    return { text, sources };
                } else {
                    return { text: "Sorry, I couldn't generate an insight for that query. Please try rephrasing your question.", sources: [] };
                }
            } catch (error) {
                console.error("Gemini API Error:", error);
                throw new Error("Failed to connect to the insight generator.");
            }
        }

        // Fallback function for when API is not available
        function getFallbackInsight(query) {
            const fallbackInsights = [
                "The Insight That Could Help You: Embrace challenges as opportunities for growth. Every difficult situation you overcome builds resilience and character that will serve you in future endeavors.",
                "The Insight That Could Help You: Focus on progress, not perfection. Small, consistent steps forward often lead to greater long-term success than trying to achieve everything at once.",
                "The Insight That Could Help You: Your mindset determines your reality. Approach situations with curiosity and a learning attitude rather than fear of failure.",
                "The Insight That Could Help You: Authenticity creates connection. Being true to yourself allows you to form genuine relationships and opportunities that align with your values.",
                "The Insight That Could Help You: Balance is key to sustainability. Make time for rest and reflection alongside your ambitious pursuits to maintain energy and perspective."
            ];
            
            // Simple hash function to get consistent results for the same query
            let hash = 0;
            for (let i = 0; i < query.length; i++) {
                hash = ((hash << 5) - hash) + query.charCodeAt(i);
                hash = hash & hash;
            }
            
            const index = Math.abs(hash) % fallbackInsights.length;
            return { 
                text: fallbackInsights[index],
                sources: []
            };
        }

        // --- UI & Event Handlers ---
        document.addEventListener('DOMContentLoaded', () => {
            // Life Insight Generator Variables
            const navbar = document.getElementById('navbar');
            const queryInput = document.getElementById('insight-query'); 
            const generateButton = document.getElementById('generate-insight');
            const insightOutputDiv = document.getElementById('insight-output');
            const insightText = document.getElementById('insight-text');
            const insightSources = document.getElementById('insight-sources');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorDiv = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const buttonText = document.getElementById('button-text');

            // Navbar shadow on scroll
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('shadow-xl');
                    navbar.classList.remove('shadow-lg');
                } else {
                    navbar.classList.add('shadow-lg');
                    navbar.classList.remove('shadow-xl');
                }
            });

            // Carousel auto-scroll
            const carousel = document.querySelector('.carousel-container');
            if (carousel) {
                let currentScroll = 0;
                let scrollInterval;
                
                const startScroll = () => {
                    const itemWidth = carousel.querySelector('.carousel-item').offsetWidth + 16;
                    
                    scrollInterval = setInterval(() => {
                        currentScroll += itemWidth;
                        
                        if (currentScroll >= carousel.scrollWidth - carousel.clientWidth) {
                            currentScroll = 0;
                        }

                        carousel.scrollTo({
                            left: currentScroll,
                            behavior: 'smooth'
                        });
                    }, 4000);
                };
                
                carousel.addEventListener('mouseenter', () => clearInterval(scrollInterval));
                carousel.addEventListener('mouseleave', startScroll);
                carousel.addEventListener('touchstart', () => clearInterval(scrollInterval));
                carousel.addEventListener('touchend', startScroll);
                
                startScroll();
            }

            // Life Insight Generator Handler 
            generateButton.addEventListener('click', async () => {
                const query = queryInput.value.trim();

                if (query.length < 5) {
                    errorText.textContent = "Please enter a question with at least 5 characters.";
                    errorDiv.classList.remove('hidden');
                    return;
                }

                // UI State: Loading
                errorDiv.classList.add('hidden');
                insightOutputDiv.classList.add('hidden');
                loadingIndicator.classList.remove('hidden');
                generateButton.disabled = true;
                buttonText.textContent = "Processing...";

                try {
                    let result;
                    
                    // Check if API key is provided
                    if (!apiKey) {
                        // Use fallback if API key is not set
                        result = getFallbackInsight(query);
                    } else {
                        // Use the actual API
                        result = await getLifeInsight(query);
                    }
                    
                    const { text, sources } = result;
                    
                    insightText.innerHTML = text.replace(/\n/g, '<br>');

                    // Display sources if available
                    if (sources.length > 0) {
                        insightSources.innerHTML = 'Source(s): ' + sources.map((s, i) => 
                            `<a href="${s.uri}" target="_blank" class="text-teal-600 hover:underline">${s.title || `Source ${i + 1}`}</a>`
                        ).join(', ');
                    } else {
                        insightSources.textContent = 'Based on Jerry\'s personal and professional experience.';
                    }

                    // UI State: Success
                    insightOutputDiv.classList.remove('hidden');

                } catch (e) {
                    // UI State: Error
                    errorText.textContent = e.message || "An unexpected error occurred during generation.";
                    errorDiv.classList.remove('hidden');
                } finally {
                    // UI State: Reset
                    loadingIndicator.classList.add('hidden');
                    generateButton.disabled = false;
                    buttonText.textContent = "Get Life Insight üí°";
                }
            });
        });
    </script>
</body>
</html>
